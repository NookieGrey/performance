// node src/generatorUtils.mjs --experimental-modules

Promise.resolve({
    "normal": "[0.22999997599981725,18.635000131325796,1.4650000084657222,1.1499999673105776,0.599999912083149,0.9500000451225787,0.9699999645818025,0.38499999209307134,23.62000005086884,1.7599999846424907,1.1650000524241477,0.6850000063423067,1.0399999446235597,1.0199999960605055,0.2749999985098839,0.6200000352691859,45.6249997660052,4.8099999548867345,0.4949999856762588,0.3449999785516411,1.605000055860728,40.865000075427815,13.755000312812626,7.460000109858811,8.114999916870147,4.5149999496061355,0.02500001573935151,2.2499999904539436,0.7899999327491969,2.069999958621338,0.4650000191759318,1.5150001272559166,1.8050000944640487,0.12000001152046025,4.934999684337527,1.1849999136757106,0.8450000023003668,49.809999705757946,4.295000078855082,0.04499999340623617,4.714999930001795,2.160000061849132,0.404999969759956,0.3299999516457319,0.10000000474974513,1.5649999841116369,1.3099998759571463,0.24500000290572643,0.6099999882280827,47.15000017313287,4.480000090552494,0.4600000102072954,0.3699999360833317,2.050000010058284,0.18499998259358108,1.554999966174364,0.12999994214624166,0.2500000118743628,1.7599999846424907,45.66499998327345,15.015000331914052,6.810000340919942,8.405000116908923,4.3349998304620385,0.18500001169741154,2.540000044973567,0.754999986384064,2.1600000036414713,0.5449999880511314,1.930000027641654,1.7449999577365816,0.7549998990725726,0.3350000479258597,0.21999998716637492,1.125000009778887,0.3649999853223562,2.984999940963462,2.0800000056624413,0.030000024707987905,0.11500000255182385,1.1000000522471964,1.129999989643693,1.1449999583419412,0.22499999613501132,0.6200000061653554,42.824999924050644,4.364999971585348,0.43000001460313797,0.06000002031214535,1.330000173766166,1.2749999586958438,1.2349999451544136,0.24999998277053237,0.5999999993946403,45.20000045886263,4.560000001220033,0.44000003254041076,0.33500001882202923,2.150000014808029,0.1749999646563083,1.47999994806014,0.12499996228143573,1.8749999580904841,76.6000002331566,18.92499957466498,0.4150001041125506,0.15000003622844815,0.10500001371838152,1.4650000666733831,1.8100000452250242,0.5850000306963921,0.06500002928078175,0.03500000457279384,0.04500002251006663,3.1300000846385956,0.48000001697801054,0.06500002928078175,1.7999998817685992,1.6799999866634607,2.135000075213611,1.754999946570024,1.754999946570024,1.7650000227149576,1.984999980777502,1.7600000137463212,1.9549999560695142,2.4149999662768096,1.8649997655302286,1.6499999910593033,1.9600000814534724,0.670000008540228,1.3549999857787043,0.375000003259629,1.3849999813828617,1.4849999570287764,1.104999944800511,0.9600000339560211,0.020000006770715117,0.5050000036135316,0.020000006770715117,0.8150000940077007,2.1849999902769923,0.5949999613221735,0.3849999629892409,0.39499992271885276,0.22500005434267223,9.169999917503446,3.4399999713059515,0.2999999560415745,1.1499999673105776,1.4300000038929284,1.3099999632686377,0.6850000354461372,0.034999975468963385,0.014999997802078724,0.36000003456138074,0.1149999734479934,5.719999986467883,1.4149999769870192,0.404999969759956,0.4799999878741801,0.8700000471435487,1.524999999674037,0.5650000530295074,0.375000003259629,0.3650000726338476,0.22000001627020538,10.819999763043597,5.884999845875427,0.4549999430309981,0.21999998716637492,0.029999995604157448,0.22499996703118086,0.36000003456138074,0.2899999963119626,0.10500001371838152,8.44499989761971,0.5399999499786645,1.7450000159442425,0.30999997397884727,0.1399999891873449,0.5049999745097011,0.19500002963468432,25.535000284435228,1.424999994924292,1.3799999142065644,0.34499994944781065,0.02999996650032699,0.24500000290572643,27.519999799551442,0.4300000437069684,0.00999998883344233,2.799999783746898,1.8100000743288547,0.0050000089686363935,2.4499999708496034,0.36999996518716216,1.2499998847488314,0.3299999516457319,1.1300000478513539,0.674999988405034,1.634999964153394,0.324999971780926,1.185000000987202,1.4900000824127346,0.2999999560415745,1.2200000055599958,0.295000005280599,1.0300000431016088,0.6500000017695129,0.8349999261554331,43.019999749958515,10.994999844115227,5.189999850699678,5.620000156341121,3.944999916711822,0.03999998443759978,0.12499999138526618,4.000000160885975,2.2250000620260835,0.9649998683016747,0.055000040447339416,0.25499999173916876,0.61500005540438,47.17000023811124,4.744999983813614,0.4700000281445682,0.3800000704359263,1.6950000426732004,0.17999994452111423,1.4099999971222132,0.13000002945773304,0.18999996245838702,0.15999999595806003,2.479999966453761,0.8950000046752393,2.2449999523814768,0.6000000284984708,2.110000030370429,1.9400000455789268,1.575000147568062,70.99999996717088,15.385000122478232,9.55500011332333,8.270000136690214,5.525000189663842,0.03999995533376932,0.2099999983329326,6.034999940311536,1.099999964935705,0.24999998277053237,0.5999999993946403,45.46499971183948,4.704999970272183,0.484999967738986,0.3449999785516411,1.6350000514648855,0.16500000492669642,1.6799999866634607,0.12999997125007212,0.23000003420747817,0.23999999393709004,2.8199999942444265,0.965000013820827,2.039999875705689,0.5149999633431435,2.0450001175049692,1.959999994141981,1.459999883081764,70.7699999329634,14.760000398382545,9.500000160187483,8.519999973941594,5.6199998944066465,0.0549999822396785,7.1350001089740545,0.11999998241662979,1.1999999405816197,0.2450000320095569,0.6250000151339918,46.33499984629452,4.609999974491075,0.4700000281445682,0.35499996738508344,1.7149999039247632,0.16499997582286596,1.8050001235678792,1.8300000810995698,0.1449999981559813,1.804999919841066,0.15000003622844815,0.14500002725981176,0.15499995788559318,0.09999997564591467,2.634999982547015,0.7800000021234155,1.8400000117253512,0.5099999543745071,1.9149999716319144,1.8850000051315874,1.5699999639764428,73.87499982723966,16.124999936437234,10.040000430308282,8.549999794922769,5.42999996105209,0.04499999340623617,0.1200000406242907,6.190000072820112,1.1750000121537596,0.2599999716039747,0.6100000173319131,47.08499976550229,4.560000088531524,0.4900000640191138,0.35499996738508344,2.370000001974404,0.5000000237487257,1.749999908497557,1.5799999237060547,0.1500000071246177,1.5850000199861825,0.12499999138526618,0.22999997599981725,0.20000003860332072,0.21000002743676305,2.620000042952597,0.8699999889358878,1.8300001102034003,0.4999999073334038,1.8649998819455504,1.8700000655371696,1.6299999551847577,72.02500005951151,15.515000151935965,10.015000036219135,8.260000235168263,5.335000023478642,0.044999964302405715,7.344999932684004,0.12500002048909664,1.1850000882986933,0.22999997599981725,0.6199999479576945,47.28000011527911,4.495000001043081,0.4600000975187868,0.3599999472498894,2.0599999697878957,0.1700000138953328,1.5650000132154673,1.7150000494439155,0.14499996905215085,7.400000031339005,0.1149999734479934,0.13500000932253897,0.1200000406242907,0.12000001152046025,2.709999884245917,0.864999950863421,1.8999999738298357,0.47000005724839866,1.9150000589434057,1.9850000098813325,1.4999999548308551,70.81000035395846,16.485000029206276,10.63500007148832,8.215000241762027,5.710000346880406,0.03500000457279384,7.36499999766238,0.1399999891873449,1.1900000390596688,0.2350000140722841,0.6099999882280827,46.23499992885627,4.6449999790638685,0.45999992289580405,0.3600000636652112,2.064999978756532,0.1700000138953328,1.9249999604653567,1.7099999240599573,0.1449999981559813,1.8449999915901572,0.12000001152046025,0.13000000035390258,0.1449999399483204,0.18999993335455656,1.7100000695791095,1.2900001020170748,5.689999932656065,2.090000023599714,0.07499995990656316,2.170000079786405,0.7449999393429607,2.5049999821931124,0.5199999723117799,1.8850000051315874,1.8100000452250242,2.0450000010896474,0.4949999856762588,2.015000121900812,0.44500004150904715,1.6550000291317701,1.0600000387057662,0.2799999783746898,1.6649999597575516,0.24999998277053237,0.6099999882280827,45.0700000510551,4.055000201333314,0.44000003254041076,0.3500000457279384,1.660000125411898,0.139999930979684,1.3749998761340976,1.5899999998509884,0.15000003622844815,1.5050000220071524,0.13499998021870852,0.13000000035390258,0.13000000035390258,0.14000001829117537,2.6599999400787055,0.834999984363094,1.8699998618103564,0.510000012582168,1.9449999381322414,2.005000045755878,2.2749998897779733,0.4149999876972288,1.4900001406203955,0.3650000726338476,1.3300000864546746,0.8499999530613422,0.4949999856762588,0.4349999944679439,0.28000003658235073,1.9700000120792538,0.9000000427477062,1.6650000179652125,0.375000003259629,2.490000013494864,0.990000058664009,2.3949999595060945,0.4499999631661922,1.6200000245589763,0.40499999886378646,1.6499999910593033,1.850000029662624,1.9700000702869147,0.7899999618530273,1.7949999892152846,0.39000000106170774,1.47999994806014,1.0099999781232327]",
    "patched": "[0.24500000290572643,23.154999915277585,3.849999950034544,0.1999999803956598,1.6249999753199518,4.570000019157305,0.9299999510403723,0.3349999897181988,23.584999900776893,1.7600000137463212,1.1749999248422682,4.000000102678314,0.8399999642278999,0.9900000004563481,0.2500000118743628,0.7949999999254942,41.410000005271286,4.75999983609654,0.4450000706128776,0.39000000106170774,3.0250000418163836,0.29499997617676854,2.630000002682209,0.01500002690590918,2.2200000239536166,1.9149999716319144,1.664999988861382,48.175000032642856,18.9849998569116,15.015000390121713,11.664999939966947,11.67500059818849,0.059999991208314896,0.09999997564591467,11.484999908134341,1.1449999583419412,0.830000004498288,49.95499993674457,4.484999924898148,0.4799999878741801,0.35000001662410796,1.634999964153394,47.079999989364296,23.30000002984889,16.360000328859314,13.45999981276691,11.390000086976215,0.13499998021870852,1.259999960893765,11.585000320337713,1.1100000701844692,0.2450000320095569,0.6350000330712646,46.295000065583736,4.299999884096906,0.42500003473833203,0.36499995621852577,1.6850000247359276,0.14000001829117537,1.5650000132154673,0.15500004519708455,0.2049999893642962,0.2599999716039747,1.8549999804235995,47.41500012460165,20.435000013094395,14.779999910388142,13.504999747965485,11.205000220797956,0.06499991286545992,2.8499999607447535,0.26500000967644155,1.8650000565685332,0.020000006770715117,1.6499999910593033,1.5049998764880002,0.7149999728426337,0.3299999807495624,0.20000000949949026,1.0099999490194023,0.36999996518716216,2.9050000885035843,2.5649999734014273,0.014999997802078724,0.13499998021870852,1.0600000678095967,1.2049999786540866,1.0550000006332994,0.2400000230409205,0.6299999658949673,42.54000014043413,4.240000038407743,0.43500002357177436,0.05500001134350896,1.2549998646136373,1.2350000906735659,1.2749999877996743,0.23499998496845365,0.644999963697046,45.57500025839545,4.634999902918935,0.455000001238659,0.33999999868683517,2.0749999093823135,0.20000000949949026,1.539999939268455,0.13499998021870852,1.8449999624863267,76.84000008157454,20.764999848324805,0.4700000863522291,0.14499996905215085,0.13500000932253897,3.820000041741878,0.28000003658235073,2.3599999549333006,0.02499992842786014,2.0650000078603625,1.7050001479219645,1.8699999200180173,1.3499999477062374,1.6300000133924186,0.7600000535603613,0.7299999997485429,3.1350000062957406,1.5200000198092312,1.25500003923662,0.6250001024454832,0.050000002374872565,0.040000013541430235,0.04000004264526069,0.040000013541430235,0.03499994636513293,31.60000013303943,0.33999994047917426,0.01999997766688466,1.4800000644754618,1.6049999394454062,1.5850000199861825,1.5450000355485827,1.5999999886844307,1.5600000624544919,1.554999966174364,2.724999940255657,3.3199999597854912,1.6000000468920916,1.7349999689031392,1.575000089360401,0.45500005944631994,0.00999998883344233,0.8250000537373126,9.454999992158264,2.1699998760595918,0.2500000409781933,0.4050000570714474,0.3600000636652112,0.4500000213738531,0.6650000577792525,0.31499998294748366,0.2799999783746898,6.6550000628922135,7.0600000326521695,0.34999995841644704,0.15499998698942363,0.7749999931547791,1.5199999907054007,0.5649999075103551,0.3649999853223562,0.29999998514540493,0.19500000053085387,1.5149999526329339,1.2249999854248017,0.22000004537403584,0.040000013541430235,0.21000002743676305,13.88499970198609,10.449999652337283,0.4699999699369073,0.36000003456138074,0.01500002690590918,0.21999998716637492,0.0749999308027327,9.764999762410298,0.48499999684281647,8.319999615196139,0.3350000479258597,0.1849998952820897,0.2599999716039747,0.12000001152046025,35.32999998424202,1.294999907258898,0.2049999893642962,0.03999998443759978,0.20000003860332072,29.064999980619177,0.375000003259629,0.020000006770715117,2.6350000698585063,1.960000052349642,0.014999997802078724,1.5549998497590423,0.01500002690590918,1.3149999431334436,0.010000017937272787,0.9649999556131661,0.5799999926239252,1.3250000774860382,0.010000017937272787,0.9949999221134931,1.1950000189244747,0.010000017937272787,1.0200000542681664,0.004999979864805937,0.7949999708216637,0.46499999007210135,0.8549999038223177,42.080000042915344,12.965000350959599,11.049999506212771,12.275000102818012,8.9700001408346,0.05000003147870302,0.10499998461455107,9.99500000034459,3.444999922066927,1.2850000348407775,0.07500001811422408,0.23999999393709004,0.6250000151339918,47.31500020716339,4.664999985834584,0.4650000191759318,0.3600000054575503,1.7000000516418368,0.13499995111487806,1.4450000307988375,0.14000001829117537,0.2500000118743628,0.16500000492669642,3.085000003920868,0.3150000120513141,2.3549999750684947,0.025000044843181968,2.4200000043492764,2.080000063870102,1.504999992903322,72.37000006716698,22.70499974838458,16.994999954476953,13.710000144783407,12.614999985089526,0.045000051613897085,0.13000000035390258,25.064999877940863,1.449999923352152,0.23499998496845365,0.6100000173319131,46.20499990414828,4.535000101896003,0.4750000371132046,0.35500002559274435,1.8800001125782728,0.30000004335306585,1.6349999932572246,0.12999994214624166,0.1550000160932541,0.11000002268701792,3.3500000135973096,0.31000006129033864,2.2399997687898576,0.014999968698248267,2.4099998991005123,1.850000029662624,1.5199999324977398,71.15999993402511,24.200000159908086,16.919999703532085,14.049999648705125,12.450000096578151,0.05500001134350896,13.47499992698431,0.14000004739500582,1.4849999570287764,0.2300000051036477,0.619999977061525,47.61000009602867,4.565000010188669,0.48499999684281647,0.370000081602484,1.7500000540167093,0.12499996228143573,1.404999929945916,1.5550000534858555,0.15499998698942363,1.6249999171122909,0.09999997564591467,0.24500000290572643,0.16000002506189048,0.2599999716039747,1.5750000020489097,74.15000017499551,23.61499983817339,18.280000193044543,14.009999838890508,12.79499995871447,0.0549999822396785,2.37499998183921,0.25499999173916876,1.8199998594354838,0.020000035874545574,1.3700000126846135,1.470000046538189,0.12499999138526618,17.5899995083455,1.2449999048840255,0.2300000051036477,0.6749999593012035,48.254999972414225,4.889999981969595,0.44499998330138624,0.3649999853223562,1.6650000179652125,0.12499999138526618,1.4300000038929284,1.4250000822357833,0.13500000932253897,1.475000084610656,0.12499999138526618,0.21999995806254447,0.23999999393709004,0.18000000272877514,1.6849998792167753,75.68499923218042,23.979999910807237,18.249999673571438,14.905000338330865,13.000000326428562,0.03499994636513293,2.2600000083912164,0.24499997380189598,1.7700000025797635,0.020000035874545574,1.5099999436642975,1.4350001001730561,13.674999994691461,0.13499998021870852,1.369999983580783,0.25499999173916876,0.6100000173319131,45.369999861577526,4.799999936949462,0.46999994083307683,0.3450000658631325,1.6500000201631337,0.14000004739500582,1.3549999566748738,1.4850000443402678,0.1399999891873449,1.5549999952781945,0.13500000932253897,1.6650001343805343,75.42499995906837,24.10000018426217,18.375000363448635,14.404999907128513,12.710000126389787,0.1750000228639692,0.07999999797903001,0.10000000474974513,2.3550000914838165,0.26000000070780516,2.0700001041404903,0.034999975468963385,1.5450001519639045,1.5000001294538379,13.335000316146761,0.13500000932253897,1.5199999907054007,0.2350000140722841,0.6200000061653554,46.639999956823885,4.589999938616529,0.5049999745097011,0.36499995621852577,1.6349999932572246,0.1399999891873449,1.3899999321438372,1.4350000128615648,0.13499998021870852,1.585000049090013,0.12499999138526618,1.6199999954551458,1.3049999834038317,5.60500004212372,1.9950000278186053,0.10499992640689015,0.14499996905215085,0.21500000730156898,0.2099999983329326,3.0799999367445707,0.33999999868683517,3.3450000337325037,0.024999957531690598,1.9400000164750963,1.7300000763498247,2.6999999245163053,0.029999995604157448,2.4349999730475247,0.01999997766688466,1.6750000067986548,0.9999998728744686,0.10999999358318746,1.2749999586958438,0.2300000051036477,0.6150000263005495,45.80499991425313,3.9749998250044882,0.455000001238659,0.34499994944781065,1.6550000291317701,0.14000001829117537,1.4099999098107219,1.450000039767474,0.11999998241662979,1.5350001049228013,0.12500002048909664,0.13000000035390258,0.10499998461455107,0.14500002725981176,2.485000033630058,0.3150000120513141,2.3950000177137554,0.034999975468963385,1.9500000053085387,1.8149999668821692,0.4099999787285924,0.2999999560415745,0.9650000720284879,2.0749999675899744,0.024999986635521054,1.8700000655371696,0.020000006770715117,1.5450000937562436,0.8749999688006938,3.1650000310037285,0.019999948563054204,2.244999981485307,0.024999986635521054,3.010000044014305,1.095000101486221,2.389999950537458,0.024999986635521054,2.069999900413677,0.010000017937272787,1.6649998724460602,1.045000070007518]",
})
    .then(convertLocalStorageObj)
    .then(addAverage)
    .then(sort)
    .then(convert)
    .then(JSON.stringify)
    .then(console.log.bind(console));

export function convertLocalStorageObj(obj) {
    return Object.keys(obj).map(key => ({
        data: JSON.parse(obj[key]),
        name: key
    }))
}

export function getDataFromLocalStorage() {
    delete localStorage.typeIndex;

    return Array(localStorage.length).fill(0).map((item, index) => ({
        data: JSON.parse(localStorage.getItem(localStorage.key(index))),
        name: localStorage.key(index)
    }))
}

export function addAverage(json) {
    return json.map(item => ({
        ...item,
        average: Math.round(arithmeticMean(filterOutliers(item.data)))
    }));
}

export function sort(arr) {
    return arr
        .sort(function (a, b) {
            if (a.name > b.name) {
                return 1;
            }
            if (a.name < b.name) {
                return -1;
            }
            // a должно быть равным b
            return 0;
        })
}

export function convert(arr) {
    return arr.map((item, index) => ({
        ...item,
        data: item.data.map((value, index) => ({x: index, y: value})),
        index
    }))
}

function arithmeticMean(arr) {
    let sum = 0;

    arr.forEach(value => sum += (value / arr.length));

    return sum;
}

// https://gist.github.com/rmeissn/f5b42fb3e1386a46f60304a57b6d215a
function filterOutliers(someArray) {
    if (someArray.length < 4)
        return someArray;

    let values, q1, q3, iqr, maxValue, minValue;

    values = someArray.slice().sort((a, b) => a - b);//copy array fast and sort

    if ((values.length / 4) % 1 === 0) {//find quartiles
        q1 = 1 / 2 * (values[(values.length / 4)] + values[(values.length / 4) + 1]);
        q3 = 1 / 2 * (values[(values.length * (3 / 4))] + values[(values.length * (3 / 4)) + 1]);
    } else {
        q1 = values[Math.floor(values.length / 4 + 1)];
        q3 = values[Math.ceil(values.length * (3 / 4) + 1)];
    }

    iqr = q3 - q1;
    maxValue = q3 + iqr * 1.5;
    minValue = q1 - iqr * 1.5;

    return values.filter((x) => (x >= minValue) && (x <= maxValue));
}